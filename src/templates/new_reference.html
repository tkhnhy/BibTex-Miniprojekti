{% extends "layout.html" %}

{% block title %}
Create a new reference
{% endblock %}

{% block body %}

<h2>Create a new reference</h2>

<form action="/create_reference" method="post">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
        <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
        </ul>
        {% endif %}
    {% endwith %}

    <div class="field-row">
        <label for="doi-input">Fetch from DOI:</label>
        <input id="doi-input" type="text" name="doi" placeholder="10.1234/abcd.12345">
        <button id="fetch-doi-btn" type="button" class="button-green">Fetch</button>
        <span id="fetch-doi-status" style="margin-left:8px;"></span>
    </div>
    <br>
    <label for="reference_type">Entry Type:</label>
    <select name="reference_type" id="reference_type" required>
        <option value="" disabled selected>Select a type...</option>
        {% for ref_type in reference_types %}
            <option value="{{ ref_type.value }}">{{ ref_type.display_str() }}</option>
        {% endfor %}
    </select>
    <br><br>
    <div class="field-row">
        <label for="reference_key">Reference Key:</label>
        <input id="reference_key" type="text" name="reference_key" id="reference_key" required>
    </div>
    <br>
    <div class="field-row" id="tag-row">
        <div style="display:flex; gap:8px; align-items:center;">
            <label for="tag-input">Tags:</label>
            <input id="tag-input" type="text" placeholder="Enter tag" />
            <button id="add-tag-btn" type="button" class="button-green">Add tag</button>
        </div>
        <div id="tags-list" style="margin-top: 8px;"></div>
    </div>
    <div id="hidden-tag-inputs"></div>

    <div id="fields-container">
        <div id="required-group">
            <h3>Required fields:</h3>
            <div id="required-fields"></div>
        </div>
        <div id="optional-group">
            <h3>Optional fields:</h3>
            <div id="optional-fields"></div>
        </div>

        {% for field in reference_fields %}
        <div class="field-row" data-name="{{ field }}">
            <label for="{{ field }}">{{ field | replace('_', ' ') | title }}:</label><br>
            <input id="{{ field }}" type="text" name="{{ field }}"{% if field == 'author' %} placeholder="Lastname, Firstname and Doe, John and Doe, Jane" style="min-width:20rem;"{% endif %}>{% if field == 'author' %}<br><span class="note">Use "and" between authors for BibTeX compatibility</span>{% endif %}<br><br>
        </div>
        {% endfor %}
        <div class="field-row">
            <label for="comment">Comment:</label><br>
            <textarea id="comment" type="text"name="comment"></textarea><br><br>
        </div>
        
    </div>

    <button type="submit" class="button-green">
        Create
    </button>
    <button type="button" class="button-red" onclick="location.href='/'" style="margin-top: 15px;">
        Cancel
    </button>
</form>


{% endblock %}

{% block scripts %}
{% include "scripts/reference_form_script.html" %}
{% endblock %}