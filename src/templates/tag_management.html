{% extends "layout.html" %}

{% block title %}
Manage Tags
{% endblock %}

{% block body %}

<h2 class="page-title" style="display: inline-block;">Manage Tags</h2>
<button onclick="location.href='/'" class="button-green" style="float: right; margin-top: 2.0rem;">
    To main page
</button>

<div>
{% for tag, count in tags %}
    <div class="tag-item">
        <form action="/rename_tag/{{ tag.name }}" method="post" style="display:inline;">
            <label for="new_tag_name_{{tag.name}}" class="sr-only">Rename tag {{ tag.name }}</label>
            <input id="new_tag_name_{{tag.name}}" name="new_tag_name" type="text" value="{{ tag.name }}">
            <span class="tag-name"> Used by {{count}} reference{{ 's' if count != 1 else '' }}</span>
            <button type="submit" class="button-green">Apply edit</button>
        </form>
        <form action="/delete_tag/{{ tag.name }}" method="post" style="display:inline;" class="delete-tag-form" data-tag="{{ tag.name|e }}">
            <button id="delete_tag_{{tag.name}}" type="submit" class="button-red" style="margin-top: 0.35em;" aria-label="Delete tag {{ tag.name }}">Delete</button>
        </form>
    </div>
{% else %}
    <p>No tags available.</p>
{% endfor %}
</div>

<script>
/* Confirmation popup for tag deletions */
document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.delete-tag-form').forEach(function(form) {
        form.addEventListener('submit', function (ev) {
            const tag = form.dataset.tag || 'this tag';
            const msg = `Delete tag "${tag}"? This will remove it from all references and cannot be undone. Continue?`;
            if (!confirm(msg)) {
                ev.preventDefault();
            }
        });
    });
});
</script>

{% endblock %}